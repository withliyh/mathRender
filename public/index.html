<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­¦å…¬å¼ä¸åŒ–å­¦å¼æ¸²æŸ“å™¨ (PNG)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }

        h1 {
            color: #333;
            text-align: center;
        }

        .container {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            font-family: monospace;
        }

        input,
        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
        }

        select {
            width: 100%;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        button:hover {
            background-color: #45a049;
        }

        .result {
            margin-top: 20px;
            text-align: center;
        }

        .result img {
            max-width: 100%;
            border: 1px solid #ddd;
            padding: 10px;
            /* background-color: white; -- Removed, now handled by JS */
        }

        .error {
            color: red;
            font-weight: bold;
        }

        .examples {
            margin-top: 30px;
        }

        .example-item {
            margin-bottom: 10px;
            cursor: pointer;
            color: #0066cc;
        }

        hr {
            margin: 30px 0;
            border: 0;
            border-top: 1px solid #eee;
        }

        .info-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 4px;
        }

        .collapsible {
            cursor: pointer;
            background-color: #3a87ad;
            color: white;
            padding: 10px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 15px;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .collapsible:after {
            content: '\002B';
            /* + ç¬¦å· */
            font-weight: bold;
            float: right;
        }

        .active-section:after {
            content: "\2212";
            /* - ç¬¦å· */
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            background-color: #f9f9f9;
            padding: 0 10px;
            margin-bottom: 10px;
        }

        .active-section+.collapsible-content {
            max-height: 500px;
            padding: 10px;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
        }

        .header-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 15px;
            cursor: pointer;
            margin-right: 5px;
            border: 1px solid transparent;
            border-bottom: none;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
        }

        .tab:hover {
            background-color: #f0f0f0;
        }

        .tab.active {
            border-color: #ddd;
            background-color: #fff;
            margin-bottom: -1px;
        }

        .loading-spinner {
            display: none;
            margin: 20px auto;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .category-header {
            background-color: #eaeaea;
            padding: 5px 10px;
            margin-top: 20px;
            margin-bottom: 10px;
            border-radius: 4px;
            font-weight: bold;
        }

        #downloadButton {
            margin-left: 10px;
            background-color: #2196F3;
        }

        #downloadButton:hover {
            background-color: #0b7dda;
        }

        .flex-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .flex-item {
            flex: 1;
        }

        .checkerboard-bg {
            background-color: #ffffff;
            background-image: linear-gradient(45deg, #eee 25%, transparent 25%), linear-gradient(-45deg, #eee 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #eee 75%), linear-gradient(-45deg, transparent 75%, #eee 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
    </style>
</head>

<body>
    <div class="header-nav">
        <h1>æ•°å­¦å…¬å¼ä¸åŒ–å­¦å¼æ¸²æŸ“å™¨ (PNG)</h1>
    </div>

    <div class="container">
        <div class="form-group">
            <label for="formula">LaTeX å…¬å¼:</label>
            <textarea id="formula" placeholder="è¾“å…¥ LaTeX æ ¼å¼çš„æ•°å­¦å…¬å¼æˆ–åŒ–å­¦å…¬å¼ï¼Œæ”¯æŒ mhchem å’Œ chemfig ç­‰åŒ…"></textarea>
        </div>

        <button type="button" class="collapsible">æ¸²æŸ“è®¾ç½®</button>
        <div class="collapsible-content">
            <div class="form-group">
                <label for="color">æ–‡æœ¬é¢œè‰²:</label>
                <input type="color" id="color" value="#000000">
            </div>

            <div class="form-group">
                <label for="backgroundColor">èƒŒæ™¯é¢œè‰²:</label>
                <input type="color" id="backgroundColor" value="#ffffff">
                <div class="info-text">é€‰æ‹©ç™½è‰²è¡¨ç¤ºé€æ˜èƒŒæ™¯</div>
            </div>

            <div class="form-group">
                <label for="fontSize">å­—ä½“å¤§å°:</label>
                <select id="fontSize">
                    <option value="">é»˜è®¤</option>
                    <option value="8">æå° (8pt)</option>
                    <option value="10">å¾ˆå° (10pt)</option>
                    <option value="12">å° (12pt)</option>
                    <option value="14">æ­£å¸¸ (14pt)</option>
                    <option value="17">å¤§ (17pt)</option>
                    <option value="20">å¾ˆå¤§ (20pt)</option>
                    <option value="25">è¶…å¤§ (25pt)</option>
                </select>
                <div class="info-text">è°ƒæ•´å…¬å¼çš„å­—ä½“å¤§å°</div>
            </div>

            <div class="form-group">
                <label for="padding">å†…è¾¹è· (åƒç´ ):</label>
                <input type="number" id="padding" min="0" max="50" step="1" value="5">
                <div class="info-text">åœ¨å…¬å¼å‘¨å›´æ·»åŠ ç©ºç™½é—´è·ï¼Œé»˜è®¤ä¸º5åƒç´ </div>
            </div>

            <div class="flex-container">
                <div class="flex-item">
                    <label for="width">å®½åº¦ (åƒç´ ):</label>
                    <input type="number" id="width" placeholder="è‡ªåŠ¨" min="100" max="2000" step="10">
                </div>
                <div class="flex-item">
                    <label for="height">é«˜åº¦ (åƒç´ ):</label>
                    <input type="number" id="height" placeholder="è‡ªåŠ¨" min="100" max="2000" step="10">
                </div>
            </div>
            <div class="info-text">
                - åªå¡«å®½åº¦ï¼šå†…å®¹å……æ»¡å®½åº¦ï¼Œé«˜åº¦è‡ªé€‚åº”<br>
                - åªå¡«é«˜åº¦ï¼šå†…å®¹å……æ»¡é«˜åº¦ï¼Œå®½åº¦è‡ªé€‚åº”<br>
                - åŒæ—¶å¡«å†™ï¼šå†…å®¹å……æ»¡æŒ‡å®šåŒºåŸŸï¼ˆå¯èƒ½æ‹‰ä¼¸ï¼‰<br>
                - éƒ½ä¸å¡«ï¼šå†…å®¹è‡ªé€‚åº”
            </div>
        </div>

        <div class="form-group" style="margin-top: 20px;">
            <button id="render">æ¸²æŸ“å…¬å¼</button>
            <button id="downloadButton">ä¸‹è½½ç»“æœ</button>
        </div>

        <!-- æ–°å¢ï¼šå®æ—¶é¢„è§ˆåŒºåŸŸ -->
        <div class="form-group" style="margin-top: 20px;">
            <label>å®æ—¶é¢„è§ˆURLï¼ˆå¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼‰:</label>
            <div style="background-color: #f5f5f5; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                <code id="previewUrl" style="word-break: break-all; font-size: 12px; color: #666;">
                    è¯·è¾“å…¥å…¬å¼åè‡ªåŠ¨ç”Ÿæˆé¢„è§ˆURL
                </code>
            </div>
            <div style="text-align: center; margin-bottom: 10px;">
                <img id="previewImg" style="max-width: 100%; border: 1px solid #ddd; padding: 10px; display: none;"
                    alt="å…¬å¼é¢„è§ˆ">
                <div id="previewPlaceholder"
                    style="padding: 30px; border: 1px dashed #ccc; color: #999; border-radius: 4px;">
                    ğŸ“ è¾“å…¥å…¬å¼åå°†æ˜¾ç¤ºå®æ—¶é¢„è§ˆ
                </div>
            </div>
            <button id="copyUrlButton" style="background-color: #17a2b8; margin-right: 10px;">å¤åˆ¶URL</button>
            <button id="openUrlButton" style="background-color: #28a745;">åœ¨æ–°çª—å£æ‰“å¼€</button>
        </div>

        <div class="loading-spinner" id="loading"></div>

        <div class="result" id="result">
            <!-- æ¸²æŸ“ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>

    <hr>

    <div class="examples">
        <h3>ä¸¥æ ¼æ ¼å¼ç¤ºä¾‹ (è¯·æŒ‰æ ¼å¼è¾“å…¥):</h3>

        <div class="category-header">æ•°å­¦å…¬å¼æ ¼å¼ï¼š$...$</div>
        <div class="example-item" data-formula="$E = mc^2$">
            $E = mc^2$
        </div>
        <div class="example-item" data-formula="$\frac{-b \pm \sqrt{b^2-4ac}}{2a}$">
            $\frac{-b \pm \sqrt{b^2-4ac}}{2a}$
        </div>
        <div class="example-item" data-formula="$\int_{a}^{b} f(x) \, dx = F(b) - F(a)$">
            $\int_{a}^{b} f(x) \, dx = F(b) - F(a)$
        </div>
        <div class="example-item" data-formula="$\sum_{i=1}^{n} i = \frac{n(n+1)}{2}$">
            $\sum_{i=1}^{n} i = \frac{n(n+1)}{2}$
        </div>
        <div class="example-item" data-formula="$\lim_{x \to 0} \frac{\sin x}{x} = 1$">
            $\lim_{x \to 0} \frac{\sin x}{x} = 1$
        </div>

        <div class="category-header">çŸ©é˜µæ ¼å¼ï¼š$...$</div>
        <div class="example-item" data-formula="$\begin{pmatrix} a & b \\ c & d \end{pmatrix}$">
            $\begin{pmatrix} a & b \\ c & d \end{pmatrix}$
        </div>
        <div class="example-item" data-formula="$\begin{bmatrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{bmatrix}$">
            $\begin{bmatrix} 1 & 2 & 3 \\ 4 & 5 & 6 \\ 7 & 8 & 9 \end{bmatrix}$
        </div>
        <div class="example-item" data-formula="$\det(A) = \begin{vmatrix} a & b \\ c & d \end{vmatrix} = ad - bc$">
            $\det(A) = \begin{vmatrix} a & b \\ c & d \end{vmatrix} = ad - bc$
        </div>

        <div class="category-header">æ•°å­¦ç¯å¢ƒæ ¼å¼ï¼šç›´æ¥ä½¿ç”¨</div>
        <div class="example-item"
            data-formula="\begin{align} f(x) &= ax^2 + bx + c \\ &= a(x^2 + \frac{b}{a}x) + c \end{align}">
            \begin{align} f(x) &= ax^2 + bx + c \\ &= a(x^2 + \frac{b}{a}x) + c \end{align}
        </div>
        <div class="example-item"
            data-formula="\begin{cases} x & \text{if } x \geq 0 \\ -x & \text{if } x < 0 \end{cases}">
            \begin{cases} x & \text{if } x \geq 0 \\ -x & \text{if } x < 0 \end{cases} </div>
                <div class="example-item"
                    data-formula="\begin{align} \nabla \times \vec{E} &= -\frac{\partial \vec{B}}{\partial t} \\ \nabla \times \vec{B} &= \mu_0 \vec{J} + \mu_0 \varepsilon_0 \frac{\partial \vec{E}}{\partial t} \\ \nabla \cdot \vec{E} &= \frac{\rho}{\varepsilon_0} \\ \nabla \cdot \vec{B} &= 0 \end{align}">
                    \begin{align} \nabla \times \vec{E} &= -\frac{\partial \vec{B}}{\partial t} \\ \nabla \times \vec{B}
                    &= \mu_0 \vec{J} + \mu_0 \varepsilon_0 \frac{\partial \vec{E}}{\partial t} \\ \nabla \cdot \vec{E}
                    &= \frac{\rho}{\varepsilon_0} \\ \nabla \cdot \vec{B} &= 0 \end{align}
                </div>
                <div class="example-item" data-formula="\begin{gather} E = mc^2 \\ F = ma \\ p = mv \end{gather}">
                    \begin{gather} E = mc^2 \\ F = ma \\ p = mv \end{gather}
                </div>
                <div class="example-item"
                    data-formula="\begin{multline} f(x) = a_0 + a_1 x + a_2 x^2 + a_3 x^3 + a_4 x^4 \\ + a_5 x^5 + a_6 x^6 + a_7 x^7 + a_8 x^8 \end{multline}">
                    \begin{multline} f(x) = a_0 + a_1 x + a_2 x^2 + a_3 x^3 + a_4 x^4 \\ + a_5 x^5 + a_6 x^6 + a_7 x^7 +
                    a_8 x^8 \end{multline}
                </div>

                <div class="category-header">å¤šè¡Œæ•°å­¦å…¬å¼ç³»ç»Ÿ</div>
                <div class="example-item"
                    data-formula="\begin{align} \sin^2 x + \cos^2 x &= 1 \\ \tan x &= \frac{\sin x}{\cos x} \\ \sec x &= \frac{1}{\cos x} \\ \csc x &= \frac{1}{\sin x} \end{align}">
                    \begin{align} \sin^2 x + \cos^2 x &= 1 \\ \tan x &= \frac{\sin x}{\cos x} \\ \sec x &= \frac{1}{\cos
                    x} \\ \csc x &= \frac{1}{\sin x} \end{align}
                </div>
                <div class="example-item"
                    data-formula="\begin{align} \frac{d}{dx}[x^n] &= nx^{n-1} \\ \frac{d}{dx}[e^x] &= e^x \\ \frac{d}{dx}[\ln x] &= \frac{1}{x} \\ \frac{d}{dx}[\sin x] &= \cos x \end{align}">
                    \begin{align} \frac{d}{dx}[x^n] &= nx^{n-1} \\ \frac{d}{dx}[e^x] &= e^x \\ \frac{d}{dx}[\ln x] &=
                    \frac{1}{x} \\ \frac{d}{dx}[\sin x] &= \cos x \end{align}
                </div>
                <div class="example-item"
                    data-formula="\begin{align} \int x^n \, dx &= \frac{x^{n+1}}{n+1} + C \\ \int e^x \, dx &= e^x + C \\ \int \frac{1}{x} \, dx &= \ln|x| + C \\ \int \sin x \, dx &= -\cos x + C \end{align}">
                    \begin{align} \int x^n \, dx &= \frac{x^{n+1}}{n+1} + C \\ \int e^x \, dx &= e^x + C \\ \int
                    \frac{1}{x} \, dx &= \ln|x| + C \\ \int \sin x \, dx &= -\cos x + C \end{align}
                </div>

                <div class="category-header">å¤šæ­¥éª¤æ–¹ç¨‹æ±‚è§£</div>
                <div class="example-item"
                    data-formula="\begin{align} 2x + 3 &= 7 \\ 2x &= 7 - 3 \\ 2x &= 4 \\ x &= 2 \end{align}">
                    \begin{align} 2x + 3 &= 7 \\ 2x &= 7 - 3 \\ 2x &= 4 \\ x &= 2 \end{align}
                </div>
                <div class="example-item"
                    data-formula="\begin{align} x^2 - 5x + 6 &= 0 \\ (x - 2)(x - 3) &= 0 \\ x - 2 = 0 \quad \text{or} \quad x - 3 &= 0 \\ x = 2 \quad \text{or} \quad x &= 3 \end{align}">
                    \begin{align} x^2 - 5x + 6 &= 0 \\ (x - 2)(x - 3) &= 0 \\ x - 2 = 0 \quad \text{or} \quad x - 3 &= 0
                    \\ x = 2 \quad \text{or} \quad x &= 3 \end{align}
                </div>

                <div class="category-header">å¤æ‚æ•°å­¦æ¨å¯¼</div>
                <div class="example-item"
                    data-formula="\begin{align} \lim_{n \to \infty} \left(1 + \frac{1}{n}\right)^n &= e \\ \sum_{n=0}^{\infty} \frac{x^n}{n!} &= e^x \\ \int_{-\infty}^{\infty} e^{-x^2} \, dx &= \sqrt{\pi} \\ \zeta(2) = \sum_{n=1}^{\infty} \frac{1}{n^2} &= \frac{\pi^2}{6} \end{align}">
                    \begin{align} \lim_{n \to \infty} \left(1 + \frac{1}{n}\right)^n &= e \\ \sum_{n=0}^{\infty}
                    \frac{x^n}{n!} &= e^x \\ \int_{-\infty}^{\infty} e^{-x^2} \, dx &= \sqrt{\pi} \\ \zeta(2) =
                    \sum_{n=1}^{\infty} \frac{1}{n^2} &= \frac{\pi^2}{6} \end{align}
                </div>

                <div class="category-header">å¤šè¡ŒåŒ–å­¦ååº”åºåˆ—</div>
                <div class="example-item"
                    data-formula="\begin{align} \ce{CH4 + 2O2} &\ce{-> CO2 + 2H2O} \\ \ce{C2H6 + 7/2 O2} &\ce{-> 2CO2 + 3H2O} \\ \ce{C3H8 + 5O2} &\ce{-> 3CO2 + 4H2O} \end{align}">
                    \begin{align} \ce{CH4 + 2O2} &\ce{-> CO2 + 2H2O} \\ \ce{C2H6 + 7/2 O2} &\ce{-> 2CO2 + 3H2O} \\
                    \ce{C3H8 + 5O2} &\ce{-> 3CO2 + 4H2O} \end{align}
                </div>
                <div class="example-item"
                    data-formula="\begin{align} \ce{Zn + 2HCl} &\ce{-> ZnCl2 + H2 ^} \\ \ce{Mg + 2HCl} &\ce{-> MgCl2 + H2 ^} \\ \ce{Fe + 2HCl} &\ce{-> FeCl2 + H2 ^} \end{align}">
                    \begin{align} \ce{Zn + 2HCl} &\ce{-> ZnCl2 + H2 ^} \\ \ce{Mg + 2HCl} &\ce{-> MgCl2 + H2 ^} \\ \ce{Fe
                    + 2HCl} &\ce{-> FeCl2 + H2 ^} \end{align}
                </div>
                <div class="example-item"
                    data-formula="\begin{align} \ce{NaCl_{(s)}} &\ce{->[\Delta] Na^+_{(l)} + Cl^-_{(l)}} \\ \ce{2NaCl_{(l)}} &\ce{->[ç”µè§£] 2Na_{(l)} + Cl2_{(g)} ^} \\ \ce{2Na_{(s)} + Cl2_{(g)}} &\ce{-> 2NaCl_{(s)}} \end{align}">
                    \begin{align} \ce{NaCl_{(s)}} &\ce{->[\Delta] Na^+_{(l)} + Cl^-_{(l)}} \\ \ce{2NaCl_{(l)}}
                    &\ce{->[ç”µè§£] 2Na_{(l)} + Cl2_{(g)} ^} \\ \ce{2Na_{(s)} + Cl2_{(g)}} &\ce{-> 2NaCl_{(s)}} \end{align}
                </div>

                <div class="category-header">æœ‰æœºåŒ–å­¦ååº”æ­¥éª¤</div>
                <div class="example-item"
                    data-formula="\begin{align} \ce{CH3CH2OH} &\ce{->[H2SO4, \Delta] CH2=CH2 + H2O} \\ \ce{CH2=CH2 + H2O} &\ce{->[H2SO4] CH3CH2OH} \\ \ce{CH3CH2OH + CH3COOH} &\ce{->[H2SO4] CH3COOCH2CH3 + H2O} \end{align}">
                    \begin{align} \ce{CH3CH2OH} &\ce{->[H2SO4, \Delta] CH2=CH2 + H2O} \\ \ce{CH2=CH2 + H2O}
                    &\ce{->[H2SO4] CH3CH2OH} \\ \ce{CH3CH2OH + CH3COOH} &\ce{->[H2SO4] CH3COOCH2CH3 + H2O} \end{align}
                </div>

                <div class="category-header">åŒ–å­¦å¹³è¡¡ç³»ç»Ÿ</div>
                <div class="example-item"
                    data-formula="\begin{align} \ce{N2 + 3H2} &\ce{<=> 2NH3} \\ \ce{2SO2 + O2} &\ce{<=> 2SO3} \\ \ce{H2 + I2} &\ce{<=> 2HI} \\ \ce{PCl5} &\ce{<=> PCl3 + Cl2} \end{align}">
                    \begin{align} \ce{N2 + 3H2} &\ce{<=> 2NH3} \\ \ce{2SO2 + O2} &\ce{<=> 2SO3} \\ \ce{H2 + I2} &\ce{<=>
                                2HI} \\ \ce{PCl5} &\ce{<=> PCl3 + Cl2} \end{align}
                </div>

                <div class="category-header">ç”µåŒ–å­¦ååº”</div>
                <div class="example-item"
                    data-formula="\begin{align} \text{é˜³æï¼š} \ce{Zn} &\ce{-> Zn^2+ + 2e^-} \\ \text{é˜´æï¼š} \ce{Cu^2+ + 2e^-} &\ce{-> Cu} \\ \text{æ€»ååº”ï¼š} \ce{Zn + Cu^2+} &\ce{-> Zn^2+ + Cu} \end{align}">
                    \begin{align} \text{é˜³æï¼š} \ce{Zn} &\ce{-> Zn^2+ + 2e^-} \\ \text{é˜´æï¼š} \ce{Cu^2+ + 2e^-} &\ce{-> Cu}
                    \\ \text{æ€»ååº”ï¼š} \ce{Zn + Cu^2+} &\ce{-> Zn^2+ + Cu} \end{align}
                </div>

                <div class="category-header">é…¸ç¢±æ»´å®šè¿‡ç¨‹</div>
                <div class="example-item"
                    data-formula="\begin{align} \ce{HCl + NaOH} &\ce{-> NaCl + H2O} \\ \ce{H2SO4 + 2NaOH} &\ce{-> Na2SO4 + 2H2O} \\ \ce{CH3COOH + NaOH} &\ce{-> CH3COONa + H2O} \end{align}">
                    \begin{align} \ce{HCl + NaOH} &\ce{-> NaCl + H2O} \\ \ce{H2SO4 + 2NaOH} &\ce{-> Na2SO4 + 2H2O} \\
                    \ce{CH3COOH + NaOH} &\ce{-> CH3COONa + H2O} \end{align}
                </div>

                <div class="category-header">å¤æ‚æ°§åŒ–è¿˜åŸååº”</div>
                <div class="example-item"
                    data-formula="\begin{align} \ce{MnO4^- + 8H^+ + 5e^-} &\ce{-> Mn^2+ + 4H2O} \\ \ce{Fe^2+} &\ce{-> Fe^3+ + e^-} \\ \ce{MnO4^- + 8H^+ + 5Fe^2+} &\ce{-> Mn^2+ + 4H2O + 5Fe^3+} \end{align}">
                    \begin{align} \ce{MnO4^- + 8H^+ + 5e^-} &\ce{-> Mn^2+ + 4H2O} \\ \ce{Fe^2+} &\ce{-> Fe^3+ + e^-} \\
                    \ce{MnO4^- + 8H^+ + 5Fe^2+} &\ce{-> Mn^2+ + 4H2O + 5Fe^3+} \end{align}
                </div>

                <div class="category-header">åˆ†æ­¥ååº”æœºç†</div>
                <div class="example-item"
                    data-formula="\begin{align} \text{æ­¥éª¤1ï¼š} \ce{A + B} &\ce{-> AB*} \quad \text{(æ…¢)} \\ \text{æ­¥éª¤2ï¼š} \ce{AB* + C} &\ce{-> ABC} \quad \text{(å¿«)} \\ \text{æ€»ååº”ï¼š} \ce{A + B + C} &\ce{-> ABC} \end{align}">
                    \begin{align} \text{æ­¥éª¤1ï¼š} \ce{A + B} &\ce{-> AB*} \quad \text{(æ…¢)} \\ \text{æ­¥éª¤2ï¼š} \ce{AB* + C}
                    &\ce{-> ABC} \quad \text{(å¿«)} \\ \text{æ€»ååº”ï¼š} \ce{A + B + C} &\ce{-> ABC} \end{align}
                </div>

                <div class="category-header">è¾“å…¥æ ¼å¼è¯´æ˜</div>
                <div
                    style="background-color: #fff3cd; padding: 15px; margin: 15px 0; border-radius: 4px; border: 1px solid #ffeaa7;">
                    <strong>âš ï¸ ä¸¥æ ¼æ ¼å¼è¦æ±‚ï¼š</strong><br><br>
                    <strong>1. æ•°å­¦å…¬å¼ï¼š</strong>å¿…é¡»ç”¨ <code>$...$</code> åŒ…è£…<br>
                    &nbsp;&nbsp;&nbsp;â€¢ æ­£ç¡®ï¼š<code>$E = mc^2$</code><br>
                    &nbsp;&nbsp;&nbsp;â€¢ é”™è¯¯ï¼š<code>E = mc^2</code><br><br>

                    <strong>2. åŒ–å­¦å…¬å¼ï¼š</strong>å¿…é¡»ç”¨ <code>\ce{...}</code> åŒ…è£…<br>
                    &nbsp;&nbsp;&nbsp;â€¢ æ­£ç¡®ï¼š<code>\ce{H2O}</code><br>
                    &nbsp;&nbsp;&nbsp;â€¢ é”™è¯¯ï¼š<code>H2O</code><br><br>

                    <strong>3. æ•°å­¦ç¯å¢ƒï¼š</strong>ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦åŒ…è£…<br>
                    &nbsp;&nbsp;&nbsp;â€¢ æ­£ç¡®ï¼š<code>\begin{align} ... \end{align}</code><br>
                    &nbsp;&nbsp;&nbsp;â€¢ é”™è¯¯ï¼š<code>$\begin{align} ... \end{align}$</code><br><br>

                    <strong>4. ä¸­æ–‡å†…å®¹ï¼š</strong>å¯ä»¥ç›´æ¥æ··åˆä½¿ç”¨<br>
                    &nbsp;&nbsp;&nbsp;â€¢ æ”¯æŒï¼š<code>$E = mc^2$ (çˆ±å› æ–¯å¦å…¬å¼)</code><br><br>

                    <strong>ğŸ’¡ æç¤ºï¼š</strong>ç‚¹å‡»ä¸Šæ–¹ç¤ºä¾‹å¯ä»¥è‡ªåŠ¨å¡«å…¥æ­£ç¡®æ ¼å¼
                </div>

                <div class="category-header">APIå‚æ•°æµ‹è¯•æç¤º</div>
                <div
                    style="background-color: #e8f4f8; padding: 10px; margin: 10px 0; border-radius: 4px; font-size: 0.9em;">
                    <strong>å‚æ•°æµ‹è¯•å»ºè®®ï¼š</strong><br>
                    â€¢ <strong>å­—ä½“å¤§å°:</strong> å°è¯•ä¸åŒçš„fontSizeå€¼ (8-25)<br>
                    â€¢ <strong>é¢œè‰²:</strong> ä¿®æ”¹æ–‡æœ¬é¢œè‰²å’ŒèƒŒæ™¯é¢œè‰²<br>
                    â€¢ <strong>å°ºå¯¸:</strong> è®¾ç½®width/heightæµ‹è¯•è‡ªé€‚åº”<br>
                    â€¢ <strong>å†…è¾¹è·:</strong> ä¿®æ”¹paddingå€¼è§‚å¯Ÿæ•ˆæœ<br><br>
                    <strong>æ³¨æ„:</strong> å®½åº¦/é«˜åº¦/å†…è¾¹è·è°ƒæ•´éœ€è¦ <a href="https://imagemagick.org/script/download.php#windows"
                        target="_blank">ImageMagick</a> æ”¯æŒ<br>
                    <small>å½“å‰é…ç½®è·¯å¾„: <code>C:\Program Files\ImageMagick-7.1.1-Q16\magick.exe</code></small>
                </div>

                <div class="category-header">ç›´æ¥å›¾ç‰‡æ¥å£ç¤ºä¾‹</div>
                <div
                    style="background-color: #f0f8ff; padding: 15px; margin: 15px 0; border-radius: 4px; border: 1px solid #b0d4ff;">
                    <strong>ğŸ–¼ï¸ ç›´æ¥æ˜¾ç¤ºå›¾ç‰‡æ¥å£ï¼š</strong><br><br>

                    <strong>ç¤ºä¾‹URLï¼ˆå¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼‰ï¼š</strong><br>
                    <code
                        style="background-color: #e8e8e8; padding: 5px; border-radius: 3px; display: block; margin: 5px 0;">
                        /api/render-direct?formula=%24E%3Dmc%5E2%24
                    </code>

                    <strong>å¸¦é¢œè‰²å’Œå°ºå¯¸ï¼š</strong><br>
                    <code
                        style="background-color: #e8e8e8; padding: 5px; border-radius: 3px; display: block; margin: 5px 0;">
                        /api/render-direct?formula=%24%5Cfrac%7B1%7D%7Bx%7D%24&color=%23FF0000&width=200
                    </code>

                    <strong>HTMLåµŒå…¥ç¤ºä¾‹ï¼š</strong><br>
                    <code
                        style="background-color: #e8e8e8; padding: 5px; border-radius: 3px; display: block; margin: 5px 0;">
                        &lt;img src="/api/render-direct?formula=%24E%3Dmc%5E2%24" alt="Einstein's equation"&gt;
                    </code>

                    <br><strong>ğŸ’¡ æç¤ºï¼š</strong>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li><code>/api/render</code> - ä¸‹è½½å›¾ç‰‡æ–‡ä»¶</li>
                        <li><code>/api/render-direct</code> - æµè§ˆå™¨ä¸­ç›´æ¥æ˜¾ç¤º</li>
                    </ul>
                </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // è·å–DOMå…ƒç´ 
                const formulaInput = document.getElementById('formula');
                const colorInput = document.getElementById('color');
                const backgroundColorInput = document.getElementById('backgroundColor');
                const fontSizeSelect = document.getElementById('fontSize');
                const widthInput = document.getElementById('width');
                const heightInput = document.getElementById('height');
                const paddingInput = document.getElementById('padding');
                const renderButton = document.getElementById('render');
                const downloadButton = document.getElementById('downloadButton');
                const resultDiv = document.getElementById('result');
                const loadingSpinner = document.getElementById('loading');
                const exampleItems = document.querySelectorAll('.example-item');

                // æ–°å¢ï¼šé¢„è§ˆç›¸å…³å…ƒç´ 
                const previewUrlElement = document.getElementById('previewUrl');
                const previewImg = document.getElementById('previewImg');
                const previewPlaceholder = document.getElementById('previewPlaceholder');
                const copyUrlButton = document.getElementById('copyUrlButton');
                const openUrlButton = document.getElementById('openUrlButton');

                // ç”Ÿæˆé¢„è§ˆURLçš„å‡½æ•°
                function generatePreviewUrl() {
                    const formula = formulaInput.value.trim();
                    if (!formula) {
                        previewUrlElement.textContent = 'è¯·è¾“å…¥å…¬å¼åè‡ªåŠ¨ç”Ÿæˆé¢„è§ˆURL';
                        previewImg.style.display = 'none';
                        previewPlaceholder.style.display = 'block';
                        return '';
                    }

                    const params = new URLSearchParams();
                    params.append('formula', formula);

                    const color = colorInput.value;
                    const backgroundColor = backgroundColorInput.value === '#ffffff' ? 'transparent' : backgroundColorInput.value;
                    const fontSize = fontSizeSelect.value;
                    const width = widthInput.value.trim();
                    const height = heightInput.value.trim();
                    const padding = paddingInput.value.trim() || '5';

                    if (color !== '#000000') params.append('color', color);
                    if (backgroundColor !== 'transparent') params.append('backgroundColor', backgroundColor);
                    if (fontSize) params.append('fontSize', fontSize);
                    if (width) params.append('width', width);
                    if (height) params.append('height', height);
                    if (padding !== '5') params.append('padding', padding);

                    const url = `/api/render-direct?${params.toString()}`;
                    const fullUrl = `${window.location.origin}${url}`;

                    previewUrlElement.textContent = fullUrl;

                    // æ›´æ–°é¢„è§ˆå›¾ç‰‡
                    previewImg.src = url;
                    previewImg.style.display = 'block';
                    previewPlaceholder.style.display = 'none';

                    // æ ¹æ®èƒŒæ™¯è®¾ç½®æ›´æ–°é¢„è§ˆå›¾çš„æ ·å¼
                    if (backgroundColor === 'transparent') {
                        previewImg.classList.add('checkerboard-bg');
                        previewImg.style.backgroundColor = '';
                    } else {
                        previewImg.classList.remove('checkerboard-bg');
                        previewImg.style.backgroundColor = backgroundColor;
                    }

                    return fullUrl;
                }

                // ç›‘å¬è¾“å…¥å˜åŒ–ï¼Œå®æ—¶æ›´æ–°é¢„è§ˆ
                function updatePreview() {
                    generatePreviewUrl();
                }

                formulaInput.addEventListener('input', updatePreview);
                colorInput.addEventListener('input', updatePreview);
                backgroundColorInput.addEventListener('input', updatePreview);
                fontSizeSelect.addEventListener('change', updatePreview);
                widthInput.addEventListener('input', updatePreview);
                heightInput.addEventListener('input', updatePreview);
                paddingInput.addEventListener('input', updatePreview);

                // å¤åˆ¶URLæŒ‰é’®
                copyUrlButton.addEventListener('click', function () {
                    const url = previewUrlElement.textContent;
                    if (url && url !== 'è¯·è¾“å…¥å…¬å¼åè‡ªåŠ¨ç”Ÿæˆé¢„è§ˆURL') {
                        navigator.clipboard.writeText(url).then(function () {
                            const originalText = copyUrlButton.textContent;
                            copyUrlButton.textContent = 'å·²å¤åˆ¶!';
                            copyUrlButton.style.backgroundColor = '#28a745';
                            setTimeout(function () {
                                copyUrlButton.textContent = originalText;
                                copyUrlButton.style.backgroundColor = '#17a2b8';
                            }, 2000);
                        }).catch(function () {
                            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶URL');
                        });
                    }
                });

                // åœ¨æ–°çª—å£æ‰“å¼€URLæŒ‰é’®
                openUrlButton.addEventListener('click', function () {
                    const url = previewUrlElement.textContent;
                    if (url && url !== 'è¯·è¾“å…¥å…¬å¼åè‡ªåŠ¨ç”Ÿæˆé¢„è§ˆURL') {
                        window.open(url, '_blank');
                    }
                });

                // è®¾ç½®å¯æŠ˜å éƒ¨åˆ†
                const collapsibles = document.querySelectorAll(".collapsible");
                collapsibles.forEach(item => {
                    item.addEventListener("click", function () {
                        this.classList.toggle("active-section");
                        const content = this.nextElementSibling;
                        if (content.style.maxHeight) {
                            content.style.maxHeight = null;
                        } else {
                            content.style.maxHeight = content.scrollHeight + "px";
                        }
                    });
                });

                // ä¸ºç¤ºä¾‹æ·»åŠ ç‚¹å‡»äº‹ä»¶
                exampleItems.forEach(item => {
                    item.addEventListener('click', function () {
                        formulaInput.value = this.getAttribute('data-formula');
                        updatePreview(); // ç‚¹å‡»ç¤ºä¾‹åæ›´æ–°é¢„è§ˆ
                    });
                });

                // æ¸²æŸ“æŒ‰é’®ç‚¹å‡»å¤„ç†
                renderButton.addEventListener('click', async function () {
                    const formula = formulaInput.value.trim();
                    if (!formula) {
                        resultDiv.innerHTML = '<p class="error">è¯·è¾“å…¥å…¬å¼ï¼</p>';
                        return;
                    }

                    try {
                        await renderFormula();
                        formulaInput.value = formula; // ä¿æŒè¾“å…¥æ¡†å†…å®¹ä¸æ¸²æŸ“å…¬å¼ä¸€è‡´
                    } catch (error) {
                        resultDiv.innerHTML = `<p class="error">æ¸²æŸ“å¤±è´¥: ${error.message}</p>`;
                    }
                });

                // ä¸‹è½½æŒ‰é’®ç‚¹å‡»å¤„ç†
                downloadButton.addEventListener('click', function () {
                    const imgElement = document.querySelector('#result img');
                    if (imgElement) {
                        // åˆ›å»ºä¸€ä¸ªä¸´æ—¶é“¾æ¥å…ƒç´ 
                        const a = document.createElement('a');
                        a.href = imgElement.src;

                        // è®¾ç½®ä¸‹è½½æ–‡ä»¶åä¸ºPNG
                        a.download = `formula.png`;

                        // æ¨¡æ‹Ÿç‚¹å‡»
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    } else {
                        alert('è¯·å…ˆæ¸²æŸ“å…¬å¼ï¼');
                    }
                });

                // æ¸²æŸ“å…¬å¼
                async function renderFormula() {
                    // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
                    loadingSpinner.style.display = 'block';
                    resultDiv.innerHTML = '';

                    try {
                        const color = colorInput.value;
                        const backgroundColor = backgroundColorInput.value === '#ffffff' ? 'transparent' : backgroundColorInput.value;
                        const fontSize = fontSizeSelect.value;
                        const width = widthInput.value.trim() ? parseInt(widthInput.value.trim()) : null;
                        const height = heightInput.value.trim() ? parseInt(heightInput.value.trim()) : null;
                        const padding = paddingInput.value.trim() ? parseInt(paddingInput.value.trim()) : 5;
                        const formula = formulaInput.value.trim();

                        // æ„å»ºè¯·æ±‚URL
                        const url = `/api/render`;

                        // å‡†å¤‡è¯·æ±‚å‚æ•°
                        const requestData = {
                            formula,
                            color,
                            backgroundColor,
                            padding
                        };

                        // æ·»åŠ å¯é€‰å‚æ•°
                        if (fontSize) requestData.fontSize = parseInt(fontSize);
                        if (width) requestData.width = width;
                        if (height) requestData.height = height;

                        // æ·»åŠ è°ƒè¯•ä¿¡æ¯
                        console.log('å‘é€æ¸²æŸ“è¯·æ±‚ï¼Œé¢œè‰²å€¼:', color);

                        // å‘é€POSTè¯·æ±‚
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestData)
                        });

                        if (!response.ok) {
                            let errorMessage = '';

                            try {
                                // å°è¯•è§£æJSONé”™è¯¯å“åº”
                                const errorObj = await response.json();
                                errorMessage = errorObj.error || 'æœªçŸ¥é”™è¯¯';
                            } catch (e) {
                                // å¦‚æœä¸æ˜¯JSONï¼Œå°è¯•è¯»å–æ–‡æœ¬
                                errorMessage = await response.text() || `æœåŠ¡å™¨é”™è¯¯ (${response.status})`;
                            }

                            // æ ¼å¼åŒ–æƒé™ç›¸å…³çš„é”™è¯¯ä¿¡æ¯
                            if (errorMessage.includes('security risk') ||
                                errorMessage.includes('elevated privileges') ||
                                errorMessage.includes('ç®¡ç†å‘˜æƒé™')) {

                                throw new Error(`MiKTeXæƒé™é”™è¯¯: ${errorMessage}
                
æƒé™é—®é¢˜è§£å†³æ–¹æ³•:
1. è¯·ä»¥æ™®é€šç”¨æˆ·èº«ä»½(éç®¡ç†å‘˜)è¿è¡Œæ­¤Node.jsåº”ç”¨
2. æˆ–æ‰“å¼€MiKTeX Consoleï¼Œåœ¨"è®¾ç½®"ä¸­è°ƒæ•´æƒé™è®¾ç½®
3. æˆ–è€…å°è¯•é‡æ–°å®‰è£…MiKTeXï¼Œé€‰æ‹©"ä¸ºæ‰€æœ‰ç”¨æˆ·å®‰è£…"é€‰é¡¹`);
                            }

                            throw new Error(errorMessage);
                        }

                        // è·å–äºŒè¿›åˆ¶æ•°æ®å¹¶è½¬æ¢ä¸ºURL
                        const blob = await response.blob();
                        const imageUrl = URL.createObjectURL(blob);

                        // æ ¹æ®èƒŒæ™¯è®¾ç½®å›¾ç‰‡æ ·å¼
                        let imgHtml;
                        if (backgroundColor === 'transparent') {
                            imgHtml = `<img src="${imageUrl}" class="checkerboard-bg" alt="æ¸²æŸ“å…¬å¼">`;
                        } else {
                            imgHtml = `<img src="${imageUrl}" style="background-color: ${backgroundColor};" alt="æ¸²æŸ“å…¬å¼">`;
                        }

                        // æ˜¾ç¤ºç»“æœ
                        resultDiv.innerHTML = imgHtml;
                    } catch (error) {
                        console.error('æ¸²æŸ“é”™è¯¯:', error);

                        // æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ¯ä»¥æé«˜å¯è¯»æ€§
                        let errorMessage = error.message || 'æœªçŸ¥é”™è¯¯';
                        errorMessage = errorMessage.replace(/\n/g, '<br>');
                        errorMessage = errorMessage.replace(/è§£å†³æ–¹æ³•:/g, '<strong>è§£å†³æ–¹æ³•:</strong>');

                        resultDiv.innerHTML = `<p class="error">æ¸²æŸ“å¤±è´¥:</p><p>${errorMessage}</p>`;
                    } finally {
                        // éšè—åŠ è½½åŠ¨ç”»
                        loadingSpinner.style.display = 'none';
                    }
                }
            });
        </script>
</body>

</html>